local APP_NAME = "Gemini"
local doubleTapTime = 0.4
local lastTapped = 0

-- 1. SIMPLE TOGGLE (No Resizing)
local function toggleGemini()
    local app = hs.application.find(APP_NAME)
    
    if app and app:isFrontmost() then
        app:hide()
    else
        -- Just wakes the app up exactly where it was last left
        hs.application.launchOrFocus(APP_NAME)
    end
end

-- 2. ANTI-MINIMIZE (Hide instead of Dock)
local gFilter = hs.window.filter.new(APP_NAME)
gFilter:subscribe(hs.window.filter.windowMinimized, function(win)
    win:unminimize() 
    win:application():hide()
end)

-- 3. DOUBLE-OPTION LISTENER
modifierListener = hs.eventtap.new({hs.eventtap.event.types.flagsChanged}, function(event)
    local flags = event:getFlags()
    local keyCode = event:getKeyCode()
    
    -- Detect Option key (58 is Left, 61 is Right)
    if (keyCode == 58 or keyCode == 61) and flags.alt then
        local now = hs.timer.secondsSinceEpoch()
        if (now - lastTapped) < doubleTapTime then
            toggleGemini()
            lastTapped = 0 
        else
            lastTapped = now
        end
    end
    return false
end):start()

hs.alert.show("Gemini: Simple Toggle Active")
